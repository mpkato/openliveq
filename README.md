# openliveq

This is a python package for NTCIR-13 OpenLiveQ,
and provides the following utilities:

* Utility classes for handling the OpenLiveQ data
* Feature extraction (e.g. TF-IDF, BM25, and language model)
* Some tools for learning to rank by [RankLib](https://sourceforge.net/p/lemur/wiki/RankLib/)

## Installation
```bash
git clone https://github.com/mpkato/openliveq.git
cd openliveq
python setup.py install
```

## Tools

``openliveq`` command is available afte installation.

### load
```bash
openliveq load QUESTION_FILE CLICKTHROUGH_FILE
```
This command stores question and clickthrough data into a SQLite database at `openliveq/db.sqlite3`.
See our homepage for the file formats: [NTCIR-13 OpenLiveQ](http://www.openliveq.net/).

### feature
```bash
openliveq feature QUERY_FILE QUERY_QUESTION_FILE OUTPUT_FILE
```
This command extracts features from query-question pairs described in `QUERY_QUESTION_FILE` and output the features in `OUTPUT_FILE` in the RankLib format.
See the RankLib website for the file format: [RankLib](https://sourceforge.net/p/lemur/wiki/RankLib/).

This package uses features 1-30 listed in Table 3, [Tao Qin, Tie-Yan Liu, Jun Xu, Hang Li. LETOR: A benchmark collection for research on learning to rank for information retrieval, Information Retrieval, Volume 13, Issue 4, pp. 346-374, 2010.](https://www.microsoft.com/en-us/research/wp-content/uploads/2016/08/letor3.pdf).
In addition, features include the number of answers given, the number of page views, etc.
See `openliveq/features` for details.

This command does not provide any relevance score for each query-question pair.
Use `relevance` and `judge` commands to add relevance.

### relevance
```bash
openliveq relevance OUTPUT_FILE
```
This command estimates the relevance of each question based on the clickthrough data and output the relevance in `OUTPUT_FILE`.
The click model used for the relevance estimation is a simplified _position-based model_ (rf. [Click Models for Web Search](http://www.morganclaypool.com/doi/abs/10.2200/S00654ED1V01Y201507ICR043)).
Relevance of each question is estimated as follows:

`Relevance(d_qr) = CTR_qr / exp(- r / sigma)`

where `d_qr` is the `r`-th ranked document for query `q`,
`CTR_qr` is the clickthrough rate of `d_qr`,
and `sigma` is a parameter.
This model assumes that the examination probability only depends on the rank.

`Relevance(d_qr)` is normalized so that the maximum score for a query becomes `scale` option value (default: 4).

The format of each line in the output is:
```
[Query ID]\t[Question ID]\t[Relevance grade]
```

### judge
```bash
openliveq judge FEATURE_FILE RELEVANCE_FILE OUTPUT_FILE
```
This command concatenates two files generated by `feature` and `relevance` commands. More specifically, this adds the relevance scores in `RELEVANCE_FILE` to each query-question pair in `FEATURE_FILE`,
and stores the results in `OUTPUT_FILE`.


### rank
```bash
openliveq rank FEATURE_FILE SCORE_FILE OUTPUT_FILE
```
This command ranks questions for each query in `FEATURE_FILE` based on scores in `SCORE_FILE`, and outputs the results in `OUTPUT_FILE`.

`SCORE_FILE` is typically a file generated by RankLib with options '-load', '-score', and '-save'.
The format of each line in `SCORE_FILE` must be:
```
[X]\t[Y]\t[Score]
```
where `[X]` and `[Y]` are not used (assigned by RankLib).
`[Score]` in `i`-th line is simply applied to a query-question pair in `i`-th line, `FEATURE_FILE`.

The format of each line in `OUTPUT_FILE` is:
```
[Query ID]\t[Question ID]
```
where the order represents the ranks of questions for each query.
This format follows the submission format of NTCIR-13 OpenLiveQ,
but note that a description line should be added to the top.
For example, use the following commands before submission:
```
echo "Description of your system. Change me!" > your_result.tsv
cat YOUR_OUTPUT_FILE >> your_result.tsv
```
